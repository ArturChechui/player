@startuml wiring_gpio_map.puml
title ESP32 Internet Radio - Wiring & GPIO Map

skinparam backgroundColor white
skinparam shadowing false
skinparam linetype ortho
skinparam componentStyle rectangle
skinparam nodesep 2
skinparam ranksep 10
left to right direction

component "PSU" as PSU #DDDDDD {
  [5V] as R5
  [GND] as R5_GND
}

together {
    component "Decoupling\n470µF electrolytic || 0.1µF ceramic" as DEC_L
    component "Decoupling\n470µF electrolytic || 0.1µF ceramic" as DEC_R
}

rectangle "470K Ohms" as 470K

component "ESP32-S3 SuperMini" as ESP #DDDDDD {
    [5V IN (USB-C)] as ESP_5V
    [3V3 OUT] as ESP_33
    [GND] as ESP_GND

    [GP1  (I2C_SCL)] as GP1
    [GP2  (I2C_SDA)] as GP2

    [GP3  (ENC_S1)]  as GP3
    [GP4  (ENC_S2)]  as GP4
    [GP5  (ENC_KEY)] as GP5

    [GP6  (BTN_UP)]   as GP6
    [GP7  (BTN_DOWN)] as GP7
    [GP8  (BTN_PLAY_STOP)] as GP8

    [GP11 (I2S_DIN)]  as GP11
    [GP12 (I2S_BCLK)] as GP12
    [GP13 (I2S_LRC)]  as GP13
}


package "Inputs" as Inputs {
    component "Button UP" as BUP
    component "Button DOWN" as BDN
    component "Button PLAY/STOP" as BPS

    component "Encoder EC11" as ENC {
        [GND] as ENC_GND
        [S1]  as ENC_S1
        [S2]  as ENC_S2
        [KEY] as ENC_KEY
        [VCC] as ENC_VCC
    }
}

package "I2C DEVICES" as I2C {
    component "OLED SSD1306" as OLED #DDDDDD {
      [VCC] as OLED_VCC
      [GND] as OLED_GND
      [SCL] as OLED_SCL
      [SDA] as OLED_SDA
    }

    component "AHT20" as AHT #DDDDDD {
      [VDD] as AHT_VDD
      [GND] as AHT_GND
      [SCL] as AHT_SCL
      [SDA] as AHT_SDA
    }
}

package Audio {
    component "MAX98357A #1 (Left)" as AMP_L #DDDDDD {
        [Vin] as AL_VIN
        [GND] as AL_GND
        [LRC] as AL_LRC
        [BCLK] as AL_BCLK
        [DIN] as AL_DIN
        [GAIN] as AL_GAIN
        [SD] as AL_SD
    }

    component "MAX98357A #2 (Right)" as AMP_R #DDDDDD {
        [Vin] as AR_VIN
        [GND] as AR_GND
        [LRC] as AR_LRC
        [BCLK] as AR_BCLK
        [DIN] as AR_DIN
        [GAIN] as AR_GAIN
        [SD] as AR_SD
    }

    component "Speaker L\n8Ohms 3W" as SPK_L
    component "Speaker R\n8Ohms 3W" as SPK_R
}

R5  -[#Red,thickness=3]-> ESP_5V
R5_GND -[#Grey,thickness=3]-> ESP_GND

ESP_33 -up[#Red]-> OLED_VCC
ESP_GND -up[#Grey]-> OLED_GND

ESP_33 -up[#Red]-> AHT_VDD
ESP_GND -up[#Grey]-> AHT_GND

R5 -[#Red,thickness=3]-> DEC_L
DEC_L -[#Red,thickness=3]-> AL_VIN
ESP_GND -[#Grey]-> DEC_L
DEC_L -[#Grey]-> AL_GND

R5 -[#Red,thickness=3]-> DEC_R
DEC_R -[#Red,thickness=3]-> AR_VIN
ESP_GND -[#Grey]-> DEC_R
DEC_R -[#Grey]-> AR_GND

ESP_33 -[#Red]-> ENC_VCC
ESP_GND -[#Grey]-> ENC_GND

GP1 -up[#Green]-> OLED_SCL
GP2 -up[#Brown]-> OLED_SDA
GP1 -up[#Green]-> AHT_SCL
GP2 -up[#Brown]-> AHT_SDA

GP13 -[#Teal]-> AL_LRC
GP12 -[#Blue]-> AL_BCLK
GP11 -[#Purple]-> AL_DIN
GP13 -[#Teal]-> AR_LRC
GP12 -[#Blue]-> AR_BCLK
GP11 -[#Purple]-> AR_DIN

ESP_33 -[#Red]-> AL_SD
ESP_33 -[#Red]-> 470K
470K -[#Red]-> AR_SD

AMP_L --> SPK_L
AMP_R --> SPK_R

ENC_S1 <-- GP3
ENC_S2 <-- GP4
ENC_KEY <-- GP5

BUP <-- GP6
BUP <-[#Grey]- ESP_GND 
BDN <-- GP7
BDN <-[#Grey]- ESP_GND 
BPS <-- GP8
BPS <-[#Grey]- ESP_GND 

@enduml
